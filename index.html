<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{PAGE_TITLE}}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center center;
    }

    .confirmation {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }

    .confirmation input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
    }

    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // Listen for the Azure AD B2C pageRendered event
    $(document).on("pageRendered", function () {
      console.log("Azure AD B2C page rendered");

      // Set the dynamic background
      const backgroundLoginImage = false;
      const gradientBackground = `linear-gradient(145deg, 
            rgba(207, 174, 168, 0.3) 16%, 
            rgba(139, 188, 188, 0.3) 45%, 
            rgba(100, 193, 195, 0.3) 60%, 
            rgba(73, 184, 161, 0.3) 80%, 
            rgba(80, 178, 104, 0.3) 98%)`;

      $("body").css(
        "background",
        backgroundLoginImage
          ? `url(${backgroundLoginImage}) no-repeat center/cover`
          : gradientBackground
      );

      console.log('Background set dynamically.');

      // Add dynamic label
      const label = $("<label>")
        .text("Welcome to the Login page @")
        .css({ display: "block", "font-size": "1.2em", "margin-top": "20px" });
      $("body").append(label);

      // Find the form injected by Azure AD B2C
      const $form = $("#api").find("form");

      if ($form.length) {
        console.log("Azure AD B2C form found");

        const $confirmationGroup = $("<div>").addClass("confirmation");

        const $confirmationCheckbox = $("<input>", {
          type: "checkbox",
          id: "dynamic-confirmation-checkbox",
          name: "confirmation",
        });

        const $confirmationLabel = $("<label>", {
          for: "dynamic-confirmation-checkbox",
        }).text("{{CONFIRMATION_TEXT}}");

        $confirmationGroup.append($confirmationCheckbox).append($confirmationLabel);

        const $submitButton = $form.find("button[type='submit']");
        if ($submitButton.length) {
          $confirmationGroup.insertBefore($submitButton);
          $submitButton.prop("disabled", true);

          $confirmationCheckbox.on("change", function () {
            $submitButton.prop("disabled", !$confirmationCheckbox.is(":checked"));
          });
        }
      }
    });
  </script>
</head>
<body>
  <div id="api"></div>
</body>
</html>
